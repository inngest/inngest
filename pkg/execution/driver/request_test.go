package driver

import (
	"testing"

	"github.com/stretchr/testify/require"
)

func TestSDKRequestIsBatchSizeTooLarge(t *testing.T) {
	tests := []struct {
		name     string
		req      *SDKRequest
		expected bool
	}{
		{
			name: "should return false for small batches",
			req: &SDKRequest{
				Events: []map[string]any{
					{"data": "something"},
					{"hello": "world"},
				},
			},
			expected: false,
		},
		{
			name: "should return true for large batch sizes",
			req: &SDKRequest{
				// 1MB each
				Events: []map[string]any{
					{"data": "Dij_Q6RafUvHibTkMtq3y92cBpkm4stAWB37yqGPL4OMGVxikMjgIkFmmLLY3Wxrdpk9hqCzpdl9TFel73qMIZpgAVDDzUBYz9XEOj7v8Qg1Uu3QeFK5daUQnlLN4A69QIAOEJy1vYPKnu9qBh5Lk7eVgxvie65d6ZHsmO9rD9PS9YDynHT407QnUh3dzjbGv1yBGXlt844BXI_zLES4T4wBp20mBX4762WDyUBv3pN7_hN2n4bYMzpSsV8XOnvfCTKLsaLv9m-K0onL03pRYcgFdpD42nB1U6rMYJT01RBzS_3lqw2x1qb-8lLpQz7W2fdOJUbREZhtd26W457yRtRhkV1wxBUccVR-o58lyGWMffBoah3SXJNH3rl31PmkHdUx-YPUUfcS9NnZHcZPOc3pg_6syo4m97crX5FwgbRSjtavOaxOwG3DzY5_mpa-pKQgeV6UIRnxu79NcdC8GwWKkivMkJlssK6UFjga3MyyZuayBTkshMmZdBvmDZGLgLu-dD6Y44WsjbhqtJIZWWOl2gCxTCWWuo_HHd3SwsMD0SblBgaXSaFIbNvK60-0TwLapWlbgb-3fpP4r2lfrT9_7yKEsj3aRJA9GuNABQWA9nIVw6PKvQNnrpC01j03iGQj0So0_yMzZdpruAM21ugg1j_Y5ED8wLLcuaOW82TPOUWZcoq9nCdbecl2HM6cPE7mzthyvESpbzfiXiuXzb_e0aphJCNE4oO0mv4gmu3qoqHXh-FPrBc7LsyWUn6xzkGckNwZKZvHGWFDgHwxBT95gpUkcLPspCq_lfFyAHAAaATwyIqfc1KxMUm4ZzOuNnazgEZj2KYy4UnymCGVSC7arWMM4bgTYr3ZqnqUKo0m_C4eRnTFTMdlMUl-se-QfwWsMdRPkhDdVKlNPuws1qn2eZxLaCRPIpHw7c7tNXf-5kq9DV8yGgmIREz_1032U0YVYaztftRUcjrAPx8MWh_ogkTpbt8HdfEXwVZYtufh4mEfuWSzwVLUif0lqXkKP0rino-rP3PwlNAo43IHao2PuQHMFU566Iat13HLrNXk6yeyERsBziQClTKGKc2o36NzIfubgjd-ZTUXEQr1Gtj-nxtTPemnlnUpKU2MuT_udrK9aFeZGUOTckx7g-jMn9740vRuhYMI5bbp3jsyjCuEHHCuVZBY_8-gqgRiKarVjU_iaGQoZGc0jJ_cKn5t2kkArE0cl5izDrNMPjTvIJxnhXGLXQBa_Kq3Wk-hv4RNLSle3oKnDNIkkfuxkOK9wbJojAtm3k7rQXjDM5VRkiM1tCkD29vES5uNMRj1s-X01SWYjGQ7yW_uAYJOvDMHo09z8eyDJxM3PWvcBhXWIQ=="},
					{"data": "3ruk301ONDHyIPXGinVCngED-2IvK-PukarrCm28qFS9dTsFoPM6m8rHti6wLlI1jgmD-FgZKRu_8ayA7qE4aPjby0Pk8bsNCxa577XRtqAaiRH4_z9MgAaBbbIbgZPKUBKO2QAuHmSnR3B926J_b1DSFK9xDNuanXv6q1U8O1ECM6gJcr085BeIRWaCZueMx74Pg7Uk9dbicCVBfJra1XczTG0vDhw5ZDscj5JdbBmQEVcCPw_6uNjgaKdLec5IErN0imkg2DpQ5_K6mOLOOsZoDKIkFYrkqcADRYPbcvtPsTtVerDxcaWEu-q1M6qq6GXsxh9EXLw1jL8q_Y9z01OB4TFLdVZyvb1Q1TkLuaBmeJwZjYZ8EHmgohZHmbUMFyXMdX_lOYPDGa0RXf3yAZgwrcodz3wCFRkqZx9AxxPWyNpa6Av-RKXiysWJDcBrEQTdp_sNuCKq2CDJj2khbBFdHBaASRJHU35y67mA-BciMEba8_2K5TrStdxOBZlPAxysWBAuZnrozZSfdCZsqqfKQ5_CMpuos0Wh1w8bBaNfHpYIShwvP2wmkE6rix_KpQs5-zCYEji5YW8ljeL2LvB45G41HypnsmNZybPydX6c3cz8dWTBJwF9GN6X4M3_YCpmLntt8aIrw9LrgyxTNoTJHX_w-YodRxDxmu_tuSK4UJ_0lTrAjbhZUh8gcQ7WEVi9eTadg8v9WWU-sIXd410-QxJOp5zFcVL7_bhQ5h2R3Exa0P--peo_kGxYlV050fOnPxLrWypT_1-l9y9ZpJbz7QF4vXQuIKh0lDKwDT8TOhjnGBsvvaRDO-ozKx-OkKKA0-z94MCE06cfvAQfSxu5XWloki9NWRv6i_sZXPUH21fDwr3_TN2ZWdYYyFisnZSXqnhrMlvXMwNm4aHc63CEdP_E9e4tajkMhgF658mP1vY_DtmRsGNDCt-wO8EuRNVZVKx1_BKhKN4wYpqohSsnMjgGbh11_oVRFegLSMNHuG9t3dlAje5QTWVc2UOP2zbXQwsfAd2UJq76jA7AVi45lzaRblMQ6UaPvgAoVeot-9IQVM3rxxfemekU_Hiq7vjbTYzw9x-eG8znUOo063b6A-_jhu-f8lmrkXeZcbH6SABcEom5aRtYGi842l6JtCBvmLzjN80SOwKEes7INpso5WoxW1n34UYPVkZidRoUv7fabfxSWbEe_IAayF3DNDnDmEKCECOi8vuYhUoUXcNNjOV2rgEOhcxyoIYTVjEnWwJpLTUZ_jwQmPM4JIK7PS_CBqKjQHnAMzVVJfddj2ySQ-FsNXkHJp-VI-NagAMc_iKxqrKa5cMOuVcx9_0p_ykTqdEteexPilj3kVJtkw=="},
					{"data": "d2nX2FjFztHCxWpDQQvxGXouQtX2tpWHtkgW2HiNsa10a8i0jyYvLuMqM65z-qU1UlYm1SUz4i536Wl7NRtK3Yiui3899EPgWBSSz9kb1OEJJKeD5OGHjo5QjyprEy0c_Qni8nsY6qHhUtDCpavcIhoVZm2mZTj-YspksTmFeBQUgvk3t8yoBfBe7OjCZJT6B0sQwp2iBMSYUT4tJNVGq5ljJKggh6WZ9-K6vzudaPoecEftfgo2g394_-KLvqyjvVdlKv-BOrB-8hv1qgNFA2K3dfk1if8hCfdzMccgRse8e4EjV5N8i4i-9FvET4mLDEWVHVBBy0CZz3PniaaEFUYiLM5KZP249sX_QOxpNG9qs0dGZvfpzUddBPUP4rahDbdA-crOOmTftpyuaIB7TG7yGAMFVEQ7sNeK2cxPYodDu3sy9OX7WLihmLJ0Yp3VNsZT_VJW5e3P-oVSGHjLk_U87LjwZrqr6c5FjrzzHnHpXPmfLsAusvFgDyP9gxs2vtb2IxIf4kfVVwR6jCzR11x11YBkpRYU5298JBESyDmkNx3NtXCfqyz29ugBQbrRDDvFAC5kCMuxCoOSlHOk1PL_DYnOAGWWz4tZyDhWU6zrMJVmF570gVXnfLgKPmacVKvJsNzevc6BaTzD63f2lLzncDIAFiynY1T0d06GtM-wNI0APGfg5OsEvewp6jenaogtLlX5XW5L26CWUtHydi3ZFnCcRVSNU_Zmp4VASx28dFNujfxYzOuz89eiFFKT7Wn2B0VfHBOe7hSNMbznfellFHF8bNiIixTeWwUSnckoKwx1_yFyV2fyuKFdVs_rd1eAikhIX8KnL8TaR__h3WQkMCVG3VMMs0RvGP3-qNxwAfQ4eKUbFoXjb0-30iN8Y2SU0BbQvu-oNARqjERTDPniuokefmA3jz36CHk_uX8wZtMagWKZgzd8F05RWktrqsytE1xtI5JZLg8rhviLifOe3c-2BtbcIErj_--GLDiU0OVcD0nCrBcDWOf9jxsziC7Yxu_V-AbnEwqibjnHoK-Smk5lFcJl4epmGbEJF-7eXyZK-f-L8eMZ6Xcj-ldQhH036vigDMu-0q4UhJzy2JWrDz_kGKuil32OTcrL33rTWd2LEXoWUou7KBvjCh3uheDvcBR0VHeeU0s4WjHQJQXgDLAbKgWSp8WRl1q3gVH0eVr8KtvY5y8-FJpkO2dKFnurFweXye72b4DOI-BBoHxm9pC7zI4Kjypd8QpZNPvz3ibeqD6xjjKF8vYP6S937OTOcuKCjjjA4F7GQ0GmYLEqJV3_M_gb5dWw9H8i0fiUTsopH3dOEyQBgqICKAbpRfmhdFicjNtrBa7ACucUwg=="},
					{"data": "yThduQ71Np-BkNIegSNPNw_RFqXJRPFn62jIKbHuvX-988ZJtXvOji6sOmOSUS7FyWUgxaGcKE8KwrZJTf2psA1PZNLS0snyIvGFyCXF20COjag_cQxbzB6fXKvsWPteGS4NXbs5cQtzzJARrl65xYUQ48-n_wXdt8zq7Aza1xzAtuuHjavb2AjoiIOUM56u6Y_MsdIIe3gdkxAKnYyXhhcuojgAb3JD5ZQ7kGMfh3JRA5_ytNHTv5XmV8zp265XfXTVH9VbuDKI-AokNnGpjYTtv_cucSNJthNw-RNJD9ibYxBw830qcYuU8FYwUDtmzW6k1FujTGfnmQyNQpGJnp04gabB1MbQQohr50v-Q1B2497yVOOMarsbJq4gmrxaPiv-amhCIDEmHP2-Hw94pcquV6XdllU2Tz8W10u6Q_3kshw1Jy7HUISgjCRkSXf_tU4zO9EgVuDEcEDWOmqOBeK86c2TFReu4dZBfDr9oDYD_hgeCeYBCn_RtLjaNcM9zcFrIgVxfbOzPYiz-jg37iy0acFm9_8jIZrpzWizAizdxURAN3zh3i3AipiLQpU8fKA5l_awmOHEJZEfAX41GgRPEy2LF5kfNlw3ZIMRs6saPtQ_-R48BdKzMk8TTv9sdBFeqscybdqnLd22y31xlEYv9xsF3iTRg9uYJO0I870JFBqGnIVjuowj_DXns8sTURwaSlcUgfiJpfWwgUHM5jqi3ESHfhqzg2iKWHjFRvgwUz2ovMzHj8mllsf7CsB9u2Z33naBAKs7BTUW-aTpF0pbq-zG_KAC5q2jVdcGguKOfcHNjXRJMegFsKEiv2pxFY1XHT-yVXe73-ihXMEvsunQ_u_r1r2DTC4Vb9PJ4zTxl6t1wqXaG8D7v5_y9gbIBFxjiOQazrwQ5rnPxSMNcwWsArNmpIw1AVI7qca79yJ6O9S_Ro-O8Ihe6ZFidx0Dq2wX4d6-pB1PPAJzstl4O9SxY-EdwHtgOlRzzkuazlgZA69dryWG74G55viZIRRGzx0hZqOa817gw0FKLWl4cfz0vJl09ROC4xr6fcfMqv-8qZ43mWvVNWtDaGfOOHOWO2tQph9LcBJmfC8beHjWnsnlxJgZwLFrECQCUsKexwMCUvQ-uvJ-4-h9C7NkgDYR6eokp09KfdYQBmRKVeS1nHJ5zArOQlTCA0VSFdg0JWqnxUOYSeED9cNr-CZMD9asC7znvLB5TQI3Tvxt2FPFipB0_i7Ks-tJFJFL2yrWzt1kDtCKcJwl1eubJSLkLugdEVHFD7FXPy-c8EAvaTPXVR_ms2aEyOl1QIRIGl2wHSXFFDZPqbypA6V6oiUnE23wKOcKzgh_jEaaNthNZKuolg=="},
				},
			},
		},
	}

	for _, test := range tests {
		t.Run(test.name, func(t *testing.T) {
			require.Equal(t, test.expected, test.req.IsBatchSizeTooLarge())
		})
	}
}
